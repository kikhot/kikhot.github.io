---
sidebar_position: 6
---

**假如 redis 的 key 过期之后，会立即删除吗？**

Redis 对数据设置数据的有效时间，数据过期以后，就需要将数据从内存中删除掉。可以按照不同的规则进行删除，这种删除规则就被称之为数据的删除策略（数据过期策略）。 惰性删除、定期删除

### Redis 数据删除策略-惰性删除
**惰性删除：** 设置该 key 过期时间后，我们不去管它，当需要该 key 时，我们再检查其是否过期，如果过期，我们就删除它，反之返回该 key。

![](./image/image_95e427df-3e20-49b7-9c2d-8cc591f06915.png)

**优点∶** 对 CPU 友好，只会在使用该 key 时才会进行过期检查，对于很多用不到的 key 不用浪费时间进行过期检查

**缺点∶** 对内存不友好，如果一个 key 已经过期，但是一直没有使用，那么该 key 就会一直存在内存中，内存永远不会释放

### Redis 数据删除策略-定期删除
**定期删除：** 每隔一段时间，我们就对一些 key 进行检查，删除里面过期的 key (从一定数量的数据库中取出一定数量的随机 key 进行检查，并删除其中的过期 key)。

定期清理有两种模式:

+ SLOW 模式是定时任务，执行频率默认为 10hz，每次不超过 25ms，以通过修改配置文件 redis.conf 的 hz 选项来调整这个次数
+ FAST 模式执行频率不固定，但两次间隔不低于 2ms，每次耗时不超过 1ms

**优点：** 可以通过限制删除操作执行的时长和频率来减少删除操作对 CPU 的影响。另外定期删除，也能有效释放过期键占用的内存。

**缺点：** 难以确定删除操作执行的时长和频率。



**Redis 的过期删除策略** **：惰性删除** **+** **定期删除** **两种策略进行配合使用**

![](./image/image_90dcd0bd-1404-4ea6-804b-7d3cbbacdb3e.png)

### 面试场景
:::tip[面试场景]

**面试官:** Redis 的数据过期策略有哪些?

**候选人:**

嗯~，在 redis 中提供了两种数据过期删除策略

第一种是惰性删除，在设置该 key 过期时间后，我们不去管它，当需要该 key 时，我们在检查其是否过期，如果过期，我们就删掉它，反之返回该 key 。

第二种是定期删除，就是说每隔一段时间，我们就对一些 key 进行检查，删除里面过期的 key

定期清理的两种模式:

+ SLOW 模式是定时任务，执行频率默认为 10hz，每次不超过 25ms，以通过修改配置文件 redis.conf 的 **hz** 选项来调整这个次数
+ FAST模式执行频率不固定，每次事件循环会尝试执行，但两次间隔不低于 2ms，每次耗时不超过 1ms

Redis 的过期删除策略:**惰性删除＋定期删除**两种策略进行配合使用。

:::

